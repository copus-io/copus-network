<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Comment API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .response { background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 20px; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        pre { white-space: pre-wrap; word-break: break-word; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Comment API</h1>

        <h2>Create Comment</h2>
        <form id="commentForm">
            <div class="form-group">
                <label for="articleId">Article ID:</label>
                <input type="number" id="articleId" value="1" required>
            </div>

            <div class="form-group">
                <label for="content">Comment Content:</label>
                <textarea id="content" rows="4" placeholder="Enter your comment..." required></textarea>
            </div>

            <div class="form-group">
                <label for="parentId">Parent ID (optional, for replies):</label>
                <input type="number" id="parentId" placeholder="Leave empty for top-level comment">
            </div>

            <button type="submit">Create Comment</button>
        </form>

        <hr style="margin: 30px 0;">

        <h2>Get Comments</h2>
        <form id="getCommentsForm">
            <div class="form-group">
                <label for="getArticleId">Article ID:</label>
                <input type="number" id="getArticleId" value="1" required>
            </div>

            <div class="form-group">
                <label for="pageIndex">Page Index:</label>
                <input type="number" id="pageIndex" value="1" required>
            </div>

            <div class="form-group">
                <label for="pageSize">Page Size:</label>
                <input type="number" id="pageSize" value="10" required>
            </div>

            <button type="submit" style="background: #17a2b8;">Get Comments</button>
        </form>

        <hr style="margin: 30px 0;">

        <h2>Delete Comment</h2>
        <form id="deleteForm">
            <div class="form-group">
                <label for="deleteCommentId">Comment ID to Delete:</label>
                <input type="number" id="deleteCommentId" required>
            </div>

            <button type="submit" style="background: #dc3545;">Delete Comment</button>
        </form>

        <hr style="margin: 30px 0;">

        <h2>Like Comment</h2>
        <form id="likeForm">
            <div class="form-group">
                <label for="likeCommentId">Comment ID to Like:</label>
                <input type="number" id="likeCommentId" required>
            </div>

            <button type="submit" style="background: #28a745;">Toggle Like</button>
        </form>

        <div id="response" class="response" style="display: none;">
            <h3>API Response:</h3>
            <pre id="responseContent"></pre>
        </div>
    </div>

    <script>
        function showResponse(data, isError = false) {
            const responseDiv = document.getElementById('response');
            const responseContent = document.getElementById('responseContent');

            responseDiv.className = isError ? 'response error' : 'response success';
            responseDiv.style.display = 'block';
            responseContent.textContent = JSON.stringify(data, null, 2);
        }

        document.getElementById('commentForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const articleId = parseInt(document.getElementById('articleId').value);
            const content = document.getElementById('content').value.trim();
            const parentIdInput = document.getElementById('parentId').value.trim();
            const parentId = parentIdInput ? parseInt(parentIdInput) : undefined;

            if (!content) {
                alert('请输入评论内容');
                return;
            }

            const requestData = {
                articleId,
                content,
                id: 0,
                ...(parentId && { parentId })
            };

            try {
                showResponse({ status: 'Sending request...', request: requestData });

                const response = await fetch('https://api-test.copus.network/client/reader/article/comment/createOrEdit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // 这里可能需要添加 Authorization header
                        // 'Authorization': 'Bearer your-token-here'
                    },
                    body: JSON.stringify(requestData)
                });

                const responseData = await response.json();

                if (response.ok && responseData.success) {
                    showResponse({
                        status: 'Success',
                        request: requestData,
                        response: responseData
                    });
                } else {
                    showResponse({
                        status: 'Error',
                        request: requestData,
                        response: responseData,
                        httpStatus: response.status
                    }, true);
                }
            } catch (error) {
                showResponse({
                    status: 'Network Error',
                    request: requestData,
                    error: error.message
                }, true);
            }
        });

        // Get comments form handler
        document.getElementById('getCommentsForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const articleId = parseInt(document.getElementById('getArticleId').value);
            const pageIndex = parseInt(document.getElementById('pageIndex').value);
            const pageSize = parseInt(document.getElementById('pageSize').value);

            if (!articleId || !pageIndex || !pageSize) {
                alert('请填写所有字段');
                return;
            }

            const queryParams = new URLSearchParams({
                articleId: articleId.toString(),
                pageIndex: pageIndex.toString(),
                pageSize: pageSize.toString()
            });

            try {
                showResponse({ status: 'Fetching comments...', request: { articleId, pageIndex, pageSize } });

                const response = await fetch(`https://api-test.copus.network/client/reader/article/comment/page?${queryParams.toString()}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        // 这里可能需要添加 Authorization header
                        // 'Authorization': 'Bearer your-token-here'
                    }
                });

                const responseData = await response.json();

                if (response.ok && responseData.success) {
                    showResponse({
                        status: 'Get Comments Success',
                        request: { articleId, pageIndex, pageSize },
                        response: responseData,
                        totalComments: responseData.data?.totalCount,
                        commentsCount: responseData.data?.items?.length
                    });
                } else {
                    showResponse({
                        status: 'Get Comments Error',
                        request: { articleId, pageIndex, pageSize },
                        response: responseData,
                        httpStatus: response.status
                    }, true);
                }
            } catch (error) {
                showResponse({
                    status: 'Get Comments Network Error',
                    request: { articleId, pageIndex, pageSize },
                    error: error.message
                }, true);
            }
        });

        // Delete comment form handler
        document.getElementById('deleteForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const commentId = parseInt(document.getElementById('deleteCommentId').value);

            if (!commentId) {
                alert('请输入评论ID');
                return;
            }

            if (!confirm('确定要删除这条评论吗？')) {
                return;
            }

            const requestData = { commentId };

            try {
                showResponse({ status: 'Deleting comment...', request: requestData });

                const response = await fetch('https://api-test.copus.network/client/reader/article/comment/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // 这里可能需要添加 Authorization header
                        // 'Authorization': 'Bearer your-token-here'
                    },
                    body: JSON.stringify(requestData)
                });

                const responseData = await response.json();

                if (response.ok && responseData.success) {
                    showResponse({
                        status: 'Delete Success',
                        request: requestData,
                        response: responseData
                    });
                    document.getElementById('deleteCommentId').value = '';
                } else {
                    showResponse({
                        status: 'Delete Error',
                        request: requestData,
                        response: responseData,
                        httpStatus: response.status
                    }, true);
                }
            } catch (error) {
                showResponse({
                    status: 'Delete Network Error',
                    request: requestData,
                    error: error.message
                }, true);
            }
        });

        // Like comment form handler
        document.getElementById('likeForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const commentId = parseInt(document.getElementById('likeCommentId').value);

            if (!commentId) {
                alert('请输入评论ID');
                return;
            }

            const requestData = { commentId };

            try {
                showResponse({ status: 'Toggling like...', request: requestData });

                const response = await fetch('https://api-test.copus.network/client/reader/article/comment/like', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // 这里可能需要添加 Authorization header
                        // 'Authorization': 'Bearer your-token-here'
                    },
                    body: JSON.stringify(requestData)
                });

                const responseData = await response.json();

                if (response.ok && responseData.success) {
                    showResponse({
                        status: 'Like Success',
                        request: requestData,
                        response: responseData,
                        newLikeCount: responseData.likeCount
                    });
                } else {
                    showResponse({
                        status: 'Like Error',
                        request: requestData,
                        response: responseData,
                        httpStatus: response.status
                    }, true);
                }
            } catch (error) {
                showResponse({
                    status: 'Like Network Error',
                    request: requestData,
                    error: error.message
                }, true);
            }
        });
    </script>
</body>
</html>