<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #f44336;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }
        pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
        .red-btn { background: #f44336; }
        .red-btn:hover { background: #d32f2f; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Token è°ƒè¯•å·¥å…·</h1>

        <h2>æ£€æŸ¥å­˜å‚¨çŠ¶æ€</h2>
        <button onclick="checkStorage()">ğŸ” æ£€æŸ¥ Token</button>
        <button onclick="checkUser()">ğŸ‘¤ æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯</button>
        <button onclick="testAPI()">ğŸŒ æµ‹è¯• API</button>
        <button onclick="clearStorage()" class="red-btn">ğŸ—‘ï¸ æ¸…é™¤å­˜å‚¨</button>

        <div id="results"></div>

        <h2>æ‰‹åŠ¨è®¾ç½® Token (æµ‹è¯•ç”¨)</h2>
        <div>
            <input type="text" id="tokenInput" placeholder="è¾“å…¥æµ‹è¯• token..." style="width: 60%; padding: 8px;">
            <button onclick="setTestToken()">è®¾ç½® Token</button>
        </div>

        <h2>ç”¨æˆ·ä¿¡æ¯è®¾ç½®</h2>
        <div>
            <textarea id="userInput" placeholder="è¾“å…¥ç”¨æˆ·ä¿¡æ¯ JSON..." style="width: 100%; height: 100px; padding: 8px; margin: 5px 0;"></textarea>
            <button onclick="setTestUser()">è®¾ç½®ç”¨æˆ·ä¿¡æ¯</button>
        </div>
    </div>

    <script>
        function showResult(content, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = content;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function checkStorage() {
            showResult('<h3>ğŸ” å­˜å‚¨æ£€æŸ¥ç»“æœ</h3>');

            // æ£€æŸ¥ localStorage
            const localToken = localStorage.getItem('copus_token');
            const localUser = localStorage.getItem('copus_user');

            // æ£€æŸ¥ sessionStorage
            const sessionToken = sessionStorage.getItem('copus_token');
            const sessionUser = sessionStorage.getItem('copus_user');

            showResult(`
                <strong>localStorage:</strong><br>
                Token: ${localToken ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}<br>
                User: ${localUser ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}<br><br>

                <strong>sessionStorage:</strong><br>
                Token: ${sessionToken ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}<br>
                User: ${sessionUser ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}<br>
            `);

            if (localToken) {
                showResult(`<strong>localStorage Token è¯¦æƒ…:</strong><br><pre>${localToken}</pre>`);
                const parts = localToken.split('.');
                showResult(`Token æ ¼å¼: ${parts.length === 3 ? 'âœ… æœ‰æ•ˆ JWT' : 'âŒ æ— æ•ˆæ ¼å¼'} (${parts.length} éƒ¨åˆ†)`);
            }

            if (sessionToken) {
                showResult(`<strong>sessionStorage Token è¯¦æƒ…:</strong><br><pre>${sessionToken}</pre>`);
                const parts = sessionToken.split('.');
                showResult(`Token æ ¼å¼: ${parts.length === 3 ? 'âœ… æœ‰æ•ˆ JWT' : 'âŒ æ— æ•ˆæ ¼å¼'} (${parts.length} éƒ¨åˆ†)`);
            }
        }

        function checkUser() {
            showResult('<h3>ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯æ£€æŸ¥</h3>');

            const localUser = localStorage.getItem('copus_user');
            const sessionUser = sessionStorage.getItem('copus_user');

            if (localUser) {
                try {
                    const user = JSON.parse(localUser);
                    showResult(`<strong>localStorage ç”¨æˆ·ä¿¡æ¯:</strong><br><pre>${JSON.stringify(user, null, 2)}</pre>`, 'success');
                } catch (e) {
                    showResult(`<strong>localStorage ç”¨æˆ·ä¿¡æ¯è§£æå¤±è´¥:</strong><br>${e.message}`, 'error');
                }
            }

            if (sessionUser) {
                try {
                    const user = JSON.parse(sessionUser);
                    showResult(`<strong>sessionStorage ç”¨æˆ·ä¿¡æ¯:</strong><br><pre>${JSON.stringify(user, null, 2)}</pre>`, 'success');
                } catch (e) {
                    showResult(`<strong>sessionStorage ç”¨æˆ·ä¿¡æ¯è§£æå¤±è´¥:</strong><br>${e.message}`, 'error');
                }
            }

            if (!localUser && !sessionUser) {
                showResult('âŒ æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯', 'error');
            }
        }

        async function testAPI() {
            showResult('<h3>ğŸŒ API æµ‹è¯•</h3>');

            const token = localStorage.getItem('copus_token') || sessionStorage.getItem('copus_token');

            if (!token) {
                showResult('âŒ æ²¡æœ‰æ‰¾åˆ° tokenï¼Œæ— æ³•æµ‹è¯• API', 'error');
                return;
            }

            try {
                showResult('ğŸ“¤ æ­£åœ¨æµ‹è¯•è¯„è®º API...');

                const response = await fetch('https://api-test.copus.network/client/reader/article/comment/page?articleId=1&pageIndex=1&pageSize=10', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });

                showResult(`ğŸ“¥ å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);

                const data = await response.json();
                showResult(`ğŸ“Š API å“åº”:<br><pre>${JSON.stringify(data, null, 2)}</pre>`,
                    data.success ? 'success' : 'error');

            } catch (error) {
                showResult(`ğŸ’¥ API æµ‹è¯•å¤±è´¥:<br><pre>${error.message}</pre>`, 'error');
            }
        }

        function clearStorage() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å­˜å‚¨æ•°æ®å—ï¼Ÿ')) {
                localStorage.removeItem('copus_token');
                localStorage.removeItem('copus_user');
                localStorage.removeItem('copus_auth_method');
                sessionStorage.removeItem('copus_token');
                sessionStorage.removeItem('copus_user');
                sessionStorage.removeItem('copus_auth_method');

                showResult('ğŸ—‘ï¸ æ‰€æœ‰å­˜å‚¨æ•°æ®å·²æ¸…é™¤', 'success');
            }
        }

        function setTestToken() {
            const token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                showResult('âŒ è¯·è¾“å…¥ token', 'error');
                return;
            }

            localStorage.setItem('copus_token', token);
            showResult('âœ… Token å·²è®¾ç½®åˆ° localStorage', 'success');
        }

        function setTestUser() {
            const userJson = document.getElementById('userInput').value.trim();
            if (!userJson) {
                showResult('âŒ è¯·è¾“å…¥ç”¨æˆ·ä¿¡æ¯', 'error');
                return;
            }

            try {
                // éªŒè¯ JSON æ ¼å¼
                JSON.parse(userJson);
                localStorage.setItem('copus_user', userJson);
                showResult('âœ… ç”¨æˆ·ä¿¡æ¯å·²è®¾ç½®åˆ° localStorage', 'success');
            } catch (e) {
                showResult(`âŒ JSON æ ¼å¼é”™è¯¯: ${e.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            showResult('<h3>ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œè‡ªåŠ¨æ£€æŸ¥å­˜å‚¨çŠ¶æ€</h3>');
            checkStorage();
            checkUser();
        };
    </script>
</body>
</html>